scripted_gui = {

	hell_ecall_gui = {
		context_type = player_context
		context_type = decision_category
		window_name = "hell_ecall_container"

		visible = { always=yes }
		properties = {
			hell_ecall_eng_flag = { image=[ENG.GetFlag] }
			hell_ecall_fra_flag = { image=[FRA.GetFlag] }
			hell_ecall_ita_flag = { image=[ITA.GetFlag] }
			payd_small_icon = { image=[?ecall_selector.GetFlag] }
			payd_large_icon = { image=[?ecall_selector.GetFlag] }
			payd_gold_icon  = { image=[?ecall_selector.GetFlag] }
			payd_icon = { image=[?ecall_selector.GetFlag] }
			hell_ecall_apparent_low = { image=[GetApparentLawImage] }
			hell_ecall_actual_low = { image=[GetActualLawImage] }
		}

		triggers = {
			payd_small_click_enabled = {
				NOT={ check_variable={ ecall_selector=0 }}
				check_variable = { var=GRE.debt@var:ecall_selector value=0 compare=greater_than }
			}
			payd_big_click_enabled = { 
				NOT={ check_variable={ ecall_selector=0 }} 
				check_variable = { var=GRE.debt@var:ecall_selector value=15 compare=greater_than_or_equals }
				has_completed_focus = GRE_paying_back_our_debts_in_bulk
			}
			payd_gold_click_enabled = { 
				NOT={ check_variable={ ecall_selector=0 }}
				check_variable = { var=GRE.debt@var:ecall_selector value=10 compare=greater_than_or_equals }
				custom_trigger_tooltip = { 
					tooltip=greek_debt_tokens_exist 
					check_variable = { GRE_debt_tokens>0 }
				}
			}
			payd_later_click_enabled = {
				NOT={ check_variable={ ecall_selector=0 }}
				check_variable = { var=GRE.debt@var:ecall_selector value=0 compare=greater_than }
			}
			payd_later_visible = { check_variable={ GRE.true_debt@var:ecall_selector=0 }}
			payd_now_visible = { NOT={ check_variable={ GRE.true_debt@var:ecall_selector=0 }}}
			payd_now_click_enabled = { check_variable = { GRE.ecall_froze_debt_passed_days@var:ecall_selector>5 }}
			payd_never_click_enabled = {
				NOT={ check_variable={ ecall_selector=0 }}
				check_variable = { var=GRE.debt@var:ecall_selector value=0 compare=greater_than }
			}
			payd_icon_visible = { NOT={ check_variable={ ecall_selector=0 }} }
			pay_button_click_enabled = {
				NOT={ check_variable={ ecall_selector=0 }}
				if = {
					limit = { check_variable={ ecall_paytype<2 }}
					check_variable = { ecall_payment>0 }
					check_variable = { var=GRE.paid_debt@var:ecall_selector value=100 compare=less_than }
					check_variable = { var=GRE.debt@var:ecall_selector value=ecall_payment compare=greater_than_or_equals }
					set_temp_variable = { b_ppcost=4 }
					if={ limit={NOT={check_variable={ modifier@base_debt_modifier_token=0 }}} set_temp_variable={ dmod=1 } subtract_from_temp_variable={ dmod=modifier@base_debt_modifier_token } clamp_temp_variable={ var=dmod min=0 max=1 } multiply_temp_variable={ b_ppcost=dmod }}
					set_temp_variable = { ppcost=b_ppcost }
					multiply_temp_variable = { ppcost=ecall_payment }
					multiply_temp_variable = { ppcost=ecall_percent_off }
					if = { limit = { check_variable={ ecall_paytype=0 } } has_political_power>ppcost }
					else = { check_variable={ GRE_debt_tokens>0 }}
				}
				else_if = { limit = { check_variable={ ecall_paytype=1 } } custom_trigger_tooltip = { tooltip=greek_debt_tokens_exist check_variable = { GRE_debt_tokens>0 }}}
				else_if = { limit = { check_variable={ ecall_paytype>1 } } custom_trigger_tooltip = { tooltip=certain_about_repercussions always=yes }}
			}
		}

		effects = {
			hell_ecall_eng_flag_click = { set_variable={ ecall_selector=ENG.id } clear_variable=ecall_payment }
			hell_ecall_fra_flag_click = { set_variable={ ecall_selector=FRA.id } clear_variable=ecall_payment }
			hell_ecall_ita_flag_click = { set_variable={ ecall_selector=ITA.id } clear_variable=ecall_payment }
			payd_small_click = { set_variable={ ecall_payment=1 } set_variable={ ecall_percent_off=1 } set_variable={ ecall_paytype=0 } }
			payd_small_control_click = { set_variable={ ecall_payment=2 } set_variable={ ecall_percent_off=1 } set_variable={ ecall_paytype=0 } }
			payd_small_control_shift_click = { set_variable={ ecall_payment=3 } set_variable={ ecall_percent_off=1 } set_variable={ ecall_paytype=0 } }
			payd_big_click = { set_variable={ ecall_payment=15 } set_variable={ ecall_percent_off=0.95 } set_variable={ ecall_paytype=0 } }
			payd_big_control_click = { set_variable={ ecall_payment=20 } set_variable={ ecall_percent_off=0.90 } set_variable={ ecall_paytype=0 } }
			payd_big_control_shift_click = { set_variable={ ecall_payment=25 } set_variable={ ecall_percent_off=0.85 } set_variable={ ecall_paytype=0 } }
			payd_gold_click = { set_variable={ ecall_payment=10 } set_variable={ ecall_paytype=1 } }
			payd_later_click = { 
				set_variable={ ecall_paytype=2 }
				effect_tooltip = {
					add_political_power = 50
					set_temp_variable = { findX=ecall_selector }
					set_temp_variable = { findY=-15 }
					var:ecall_selector = { custom_effect_tooltip=axal_nl_tt add_to_variable = { favor@GRE=findY tooltip=favor_hit_with_findX_by_findY_no_name_tt }}
					every_country = {
						limit = {
							is_in_array = {
								array = global.favor_mechanic
								value = THIS.id
							}
							NOT = { original_tag = GRE.ecall_selector }
						}
						set_temp_variable = { findX=THIS.id }
						set_temp_variable = { findY=-7.5 }
						add_to_variable = { THIS.favor@GRE=findY tooltip=favor_hit_with_findX_by_findY_no_name_tt }
					}
					#######################################################
					set_variable = { GRE.true_debt@var:ecall_selector = GRE.debt@var:ecall_selector }
					set_variable = { GRE.debt_package = GRE.debt@var:ecall_selector }
					var:ecall_selector = { GRE_update_debt_status = yes }
					set_variable = { GRE.ecall_froze_debt_at@var:ecall_selector=global.num_days}
					set_variable = { GRE.ecall_froze_debt_end@var:ecall_selector=global.num_days}
					add_to_variable = { GRE.ecall_froze_debt_end@var:ecall_selector=720 }
					#######################################################
					clear_variable = ecall_payment
					clear_variable = ecall_paytype
				}
			}
			payd_now_click = {
				set_variable={ ecall_paytype=2.5 }
				effect_tooltip = {
					set_variable = { GRE.debt_package = GRE.true_debt@var:ecall_selector }
					multiply_variable = { GRE.debt_package = -1 }
					var:ecall_selector = { GRE_update_debt_status = yes }
					clear_variable = GRE.true_debt@var:ecall_selector
					clear_variable = GRE.ecall_froze_debt_end@var:ecall_selector
					clear_variable = GRE.ecall_froze_debt_at@var:ecall_selector
					clear_variable = GRE.ecall_froze_debt_remaining_days@var:ecall_selector
					clear_variable = GRE.ecall_froze_debt_passed_days@var:ecall_selector
				}
			}
			payd_never_click = {
				set_variable={ ecall_paytype=3 }
				effect_tooltip = {
					set_temp_variable = { x = GRE.debt@var:ecall_selector }
					add_to_temp_variable = { x = GRE.true_debt@var:ecall_selector }
					multiply_temp_variable = { x = 3 }
					add_political_power = var:x
					set_temp_variable = { findX=ecall_selector }
					set_temp_variable = { findY=-30 }
					var:ecall_selector = { custom_effect_tooltip=axal_nl_tt add_to_variable = { favor@GRE=findY tooltip=favor_hit_with_findX_by_findY_no_name_tt }}
					every_country = {
						limit = {
							is_in_array = {
								array = global.favor_mechanic
								value = THIS.id
							}
							NOT = { original_tag = GRE.ecall_selector }
						}
						set_temp_variable = { findX=THIS.id }
						set_temp_variable = { findY=-15 }
						add_to_variable = { THIS.favor@GRE=findY tooltip=favor_hit_with_findX_by_findY_no_name_tt }
					}
					set_variable = { GRE.defaulted_on@var:ecall_selector = 1 }
					set_variable = { GRE.debt_package = GRE.debt@var:ecall_selector }
					add_to_variable = { GRE.debt_package = GRE.true_debt@var:ecall_selector }
					clear_variable = GRE.true_debt@var:ecall_selector
					var:ecall_selector = { GRE_update_debt_status = yes }
					var:ecall_selector = {
						add_opinion_modifier = {
							target = GRE
							modifier = GRE_defaulted_on_debts
						}
					}
					clear_variable = ecall_payment
				}
			}
			pay_button_click = {
				#if = { limit={ check_variable={ ecall_payment>GRE.debt@var:ecall_selector }} set_temp_variable={ ecall_payment=GRE.debt@var:ecall_selector }}
				hidden_effect = {
					if = {
						limit = { check_variable={ ecall_paytype<2 }}

						ecall_calculate_ppcosts=yes
						var:ecall_selector = { add_political_power = ppcost }
						multiply_temp_variable = { ppcost=-1 }
						if = { limit = { check_variable={ ecall_paytype=0 } } add_political_power = ppcost }
						else_if = { limit = { check_variable={ ecall_paytype=1 } } subtract_from_variable={ GRE_debt_tokens=1 }}
						#####################################################
						set_variable = { GRE.debt_package = var:ecall_payment }
						var:ecall_selector = { GRE_update_debt_status = yes }
						######[REPORT EVENTS]######
						if = { limit = { NOT = { check_variable = { GRE.ecall_selector=ENG }}} add_to_temp_array={ creditors_to_check=ENG.id } add_to_variable={ ENG.gre_times_paid@var:ecall_selector=1 } add_to_variable={ ENG.gre_total_paid@var:ecall_selector=ecall_payment }}
						if = { limit = { NOT = { check_variable = { GRE.ecall_selector=FRA }}} add_to_temp_array={ creditors_to_check=FRA.id } add_to_variable={ FRA.gre_times_paid@var:ecall_selector=1 } add_to_variable={ FRA.gre_total_paid@var:ecall_selector=ecall_payment }}
						if = { limit = { NOT = { check_variable = { GRE.ecall_selector=ITA }}} add_to_temp_array={ creditors_to_check=ITA.id } add_to_variable={ ITA.gre_times_paid@var:ecall_selector=1 } add_to_variable={ ITA.gre_total_paid@var:ecall_selector=ecall_payment }}
						for_each_scope_loop = {
							array=creditors_to_check

							if={ 
								limit={ NOT={ has_country_flag=debt_check_event_fired }}
								
								set_country_flag=debt_check_event_fired 
								country_event={ id=hellas.3321 days=3 }
							}
						}
					}
					else_if = {
						limit = { check_variable={ ecall_paytype=2 }}

						add_political_power = 50
						set_temp_variable = { findX=ecall_selector }
						set_temp_variable = { findY=-15 }
						var:ecall_selector = { add_to_variable = { favor@GRE=findY tooltip=favor_hit_with_findX_by_findY_no_name_tt }}
						every_country = {
							limit = {
								is_in_array = {
									array = global.favor_mechanic
									value = THIS.id
								}
								NOT = { original_tag = GRE.ecall_selector }
							}
							set_temp_variable = { findX=THIS.id }
							set_temp_variable = { findY=-7.5 }
							add_to_variable = { THIS.favor@GRE=findY tooltip=favor_hit_with_findX_by_findY_no_name_tt }
						}
						#######################################################
						set_variable = { GRE.true_debt@var:ecall_selector = GRE.debt@var:ecall_selector }
						set_variable = { GRE.debt_package = GRE.debt@var:ecall_selector }
						var:ecall_selector = { GRE_update_debt_status = yes }
						set_variable = { GRE.ecall_froze_debt_at@var:ecall_selector=global.num_days}
						set_variable = { GRE.ecall_froze_debt_end@var:ecall_selector=global.num_days}
						add_to_variable = { GRE.ecall_froze_debt_end@var:ecall_selector=720 }
                        set_variable = { GRE.ecall_froze_debt_remaining_days@var:ecall_selector=720 }
                        set_variable = { GRE.ecall_froze_debt_passed_days@var:ecall_selector=0}
						#######################################################
						clear_variable = ecall_payment
						clear_variable = ecall_paytype
					}
					else_if = {
						limit = { check_variable={ ecall_paytype=2.5 }}
						
						set_variable = { GRE.debt_package = GRE.true_debt@var:ecall_selector }
						multiply_variable = { GRE.debt_package = -1 }
						var:ecall_selector = { GRE_update_debt_status = yes }
						clear_variable = GRE.true_debt@var:ecall_selector
						clear_variable = GRE.ecall_froze_debt_end@var:ecall_selector
						clear_variable = GRE.ecall_froze_debt_at@var:ecall_selector
						clear_variable = GRE.ecall_froze_debt_remaining_days@var:ecall_selector
						clear_variable = GRE.ecall_froze_debt_passed_days@var:ecall_selector
					}
					else_if = {
						limit = { check_variable={ ecall_paytype=3 }}

						set_temp_variable = { x = GRE.debt@var:ecall_selector }
						add_to_temp_variable = { x = GRE.true_debt@var:ecall_selector }
						multiply_temp_variable = { x = 3 }
						add_political_power = var:x
						set_temp_variable = { findX=ecall_selector }
						set_temp_variable = { findY=-30 }
						var:ecall_selector = { add_to_variable = { favor@GRE=findY tooltip=favor_hit_with_findX_by_findY_no_name_tt }}
						every_country = {
							limit = {
								is_in_array = {
									array = global.favor_mechanic
									value = THIS.id
								}
								NOT = { original_tag = GRE.ecall_selector }
							}
							set_temp_variable = { findX=THIS.id }
							set_temp_variable = { findY=-15 }
							add_to_variable = { THIS.favor@GRE=findY tooltip=favor_hit_with_findX_by_findY_no_name_tt }
						}
						set_variable = { GRE.defaulted_on@var:ecall_selector = 1 }
						set_variable = { GRE.debt_package = GRE.debt@var:ecall_selector }
						add_to_variable = { GRE.debt_package = GRE.true_debt@var:ecall_selector }
						clear_variable = GRE.true_debt@var:ecall_selector
						var:ecall_selector = { GRE_update_debt_status = yes }
						var:ecall_selector = {
							add_opinion_modifier = {
								target = GRE
								modifier = GRE_defaulted_on_debts
							}
						}
						clear_variable = ecall_payment
						clear_variable = ecall_paytype
					}
					set_variable = { GRE.paying_debt@var:ecall_selector = 0 }
				}
			}
		}
        #################################################################################################
        #################################################################################################
        #################################################################################################
		triggers = {
			hell_ecall_governor_portrait_click_enabled = { has_idea=GRE_emmanouil_tsouderos_political_advisor }
			hell_ecall_minister_portrait_click_enabled = { has_idea=GRE_andreas_apostolidis_political_advisor }
			hell_ecall_bank_internal_steer_click_enabled = { has_idea=GRE_emmanouil_tsouderos_political_advisor has_completed_focus=GRE_greek_autarky custom_trigger_tooltip={ tooltip=hell_ecall_steering_in_other_direction if={ limit={ check_variable={ GRE.ecall_bank_internal_steer_remaining_days>0 }} has_political_power>GRE.ecall_bank_drift_immediate_cost } NOT={ check_variable={ GRE.ecall_bank_external_steer_remaining_days>0 }}} custom_trigger_tooltip={ tooltip=hell_ecall_maxed_steering NOT={ check_variable={ ecall_bank_shift=4 }}}}
			hell_ecall_bank_external_steer_click_enabled = { has_idea=GRE_emmanouil_tsouderos_political_advisor has_completed_focus=GRE_greek_autarky custom_trigger_tooltip={ tooltip=hell_ecall_steering_in_other_direction if={ limit={ check_variable={ GRE.ecall_bank_external_steer_remaining_days>0 }} has_political_power>GRE.ecall_bank_drift_immediate_cost } NOT={ check_variable={ GRE.ecall_bank_internal_steer_remaining_days>0 }}} custom_trigger_tooltip={ tooltip=hell_ecall_maxed_steering NOT={ check_variable={ ecall_bank_shift=-4 }}}}
			hell_ecall_decrease_exports_click_enabled = { has_idea=GRE_andreas_apostolidis_political_advisor has_completed_focus=GRE_greek_autarky custom_trigger_tooltip={ tooltip=hell_ecall_steering_in_other_direction if={ limit={ check_variable={ GRE.ecall_decrease_exports_remaining_days>0 }} has_political_power>GRE.ecall_exports_drift_immediate_cost } NOT={ check_variable={ GRE.ecall_increase_exports_remaining_days>0 }}} custom_trigger_tooltip={ tooltip=hell_ecall_maxed_steering NOT={ check_variable={ ecall_ministry_shift=4 }}}}
			hell_ecall_increase_exports_click_enabled = { has_idea=GRE_andreas_apostolidis_political_advisor has_completed_focus=GRE_greek_autarky custom_trigger_tooltip={ tooltip=hell_ecall_steering_in_other_direction if={ limit={ check_variable={ GRE.ecall_increase_exports_remaining_days>0 }} has_political_power>GRE.ecall_exports_drift_immediate_cost } NOT={ check_variable={ GRE.ecall_decrease_exports_remaining_days>0 }}} custom_trigger_tooltip={ tooltip=hell_ecall_maxed_steering NOT={ check_variable={ ecall_ministry_shift=-4 }}}}
			hell_ecall_upgrade_economy_click_enabled = { has_idea=GRE_andreas_apostolidis_political_advisor check_variable={ GRE.economy_level<4 } if={ limit={ check_variable={ GRE.ecall_economy_upgrade_remaining_days>0 }} has_political_power>GRE.ecall_economy_immediate_cost }}
		    hell_ecall_announce_economy_click_enabled = { has_idea=GRE_andreas_apostolidis_political_advisor }
		}
		effects = {
			hell_ecall_bank_internal_steer_click = {
				if = { 
					limit={ check_variable={ GRE.ecall_bank_internal_steer_remaining_days=0 }}

					set_variable = { GRE.ecall_bank_internal_steer_at=global.num_days}
					set_variable = { GRE.ecall_bank_internal_steer_end=global.num_days}
					add_to_variable = { GRE.ecall_bank_internal_steer_end=15 }
					set_variable = { GRE.ecall_bank_internal_steer_remaining_days=15 }
					set_variable = { GRE.ecall_bank_internal_steer_passed_days=0 }
					set_variable = { GRE.ecall_bank_drift_immediate_cost=150 }
				}
				else = {
					set_temp_variable = { ppcost=GRE.ecall_bank_drift_immediate_cost }
					multiply_temp_variable = { ppcost=-1 }
					add_political_power = ppcost
					ecall_set_bank_shift_variables_internal=yes
                    clear_variable = GRE.ecall_bank_internal_steer_remaining_days
                    clear_variable = GRE.ecall_bank_internal_steer_passed_days
				}
			}
			hell_ecall_bank_external_steer_click = {
				if = {
					limit={ check_variable={ GRE.ecall_bank_external_steer_remaining_days=0 }}

					set_variable = { GRE.ecall_bank_external_steer_at=global.num_days}
					set_variable = { GRE.ecall_bank_external_steer_end=global.num_days}
					add_to_variable = { GRE.ecall_bank_external_steer_end=15 }
					set_variable = { GRE.ecall_bank_external_steer_remaining_days=15 }
					set_variable = { GRE.ecall_bank_external_steer_passed_days=0 }
					set_variable = { GRE.ecall_bank_drift_immediate_cost=150 }
				}
				else = {
					set_temp_variable = { ppcost=GRE.ecall_bank_drift_immediate_cost }
					multiply_temp_variable = { ppcost=-1 }
					add_political_power = ppcost
					ecall_set_bank_shift_variables_external=yes
                    clear_variable = GRE.ecall_bank_external_steer_remaining_days
                    clear_variable = GRE.ecall_bank_external_steer_passed_days
				}
			}
			hell_ecall_upgrade_economy_click = {
				if = { 
					limit={ check_variable={ GRE.ecall_economy_upgrade_remaining_days=0 }}
					
					set_variable = { GRE.ecall_economy_upgrade_at=global.num_days}
					set_variable = { GRE.ecall_economy_upgrade_end=global.num_days}
					add_to_variable = { GRE.ecall_economy_upgrade_end=60 }
					set_variable = { GRE.ecall_economy_upgrade_remaining_days=60 }
					set_variable = { GRE.ecall_economy_upgrade_passed_days=0}
					set_variable={ GRE.ecall_economy_upgrade_batches_left=5 }
					set_variable = { GRE.ecall_economy_immediate_cost=250 }
					###############################################################
					effect_tooltip={ ecall_upgrade_economy_detection_test=yes }
					hidden_effect={
						random_list={
							seed=random

							upgrade_economy_avoidance={ multiply_variable={ upgrade_economy_detection=0.05 }}
							upgrade_economy_detection={ set_variable={ h50_type=0 } country_event={ id=hellas.50 days=0 }}
						}
					}
				}
				else = {
					set_temp_variable = { ppcost=GRE.ecall_economy_immediate_cost }
					multiply_temp_variable = { ppcost=-1 }
					add_political_power = ppcost
					ecall_upgrade_economy_immediate=yes
                    clear_variable = GRE.ecall_economy_upgrade_remaining_days
                    clear_variable = GRE.ecall_economy_upgrade_passed_days
                    clear_variable = GRE.ecall_economy_upgrade_batches_left
                    clear_variable = GRE.ecall_economy_batch_upgrade_in
				}
			}
			hell_ecall_announce_economy_click = {

				ecall_announce_economy_backslash_calculation=yes
				set_variable={ h50_type=1 }
				country_event={ id=hellas.50 days=0 }
			}
			hell_ecall_decrease_exports_click = {
				if = { 
					limit={ check_variable={ GRE.ecall_decrease_exports_remaining_days=0 }}

					set_variable = { GRE.ecall_decrease_exports_at=global.num_days}
					set_variable = { GRE.ecall_decrease_exports_end=global.num_days}
					add_to_variable = { GRE.ecall_decrease_exports_end=15 }
					set_variable = { GRE.ecall_decrease_exports_remaining_days=15 }
					set_variable = { GRE.ecall_decrease_exports_passed_days=0 }
					set_variable = { GRE.ecall_exports_drift_immediate_cost=150 }
				}
				else = {
					set_temp_variable = { ppcost=GRE.ecall_exports_drift_immediate_cost }
					multiply_temp_variable = { ppcost=-1 }
					add_political_power = ppcost
					ecall_set_ministry_shift_towards_less_exports=yes
                    clear_variable = GRE.ecall_decrease_exports_remaining_days
                    clear_variable = GRE.ecall_decrease_exports_passed_days
				}
			}
			hell_ecall_increase_exports_click = {
				if = {
					limit={ check_variable={ GRE.ecall_increase_exports_remaining_days=0 }}

					set_variable = { GRE.ecall_increase_exports_at=global.num_days}
					set_variable = { GRE.ecall_increase_exports_end=global.num_days}
					add_to_variable = { GRE.ecall_increase_exports_end=15 }
					set_variable = { GRE.ecall_increase_exports_remaining_days=15 }
					set_variable = { GRE.ecall_increase_exports_passed_days=0 }
					set_variable = { GRE.ecall_exports_drift_immediate_cost=150 }
				}
				else = {
					set_temp_variable = { ppcost=GRE.ecall_exports_drift_immediate_cost }
					multiply_temp_variable = { ppcost=-1 }
					add_political_power = ppcost
					ecall_set_ministry_shift_towards_more_exports=yes
                    clear_variable = GRE.ecall_increase_exports_remaining_days
                    clear_variable = GRE.ecall_increase_exports_passed_days
				}
			}
		}
	}
}

